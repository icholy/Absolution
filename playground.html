<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>Playground</title>
  <script src="../build/Connectors.js"></script>
  <script src="../build/Parser.js"></script>
  <script src="../build/Relationships.js"></script>
  <script src="../build/System.js"></script>
  <script src="../build/ElementManager.js"></script>
  <script src="../build/LayoutManager.js"></script>
  <style>

    .box {
      position: absolute;
    }

    #container {
      position: relative;
    }

    #A {
      background-color: red;
      left: 100px;
      width: 600px;
    }

    .green {
      background-color: green;
    }

  </style>
</head>
<body>

  <div class="box" id="A"
    data-anchor-height="A.width * x">A</div>
  <div class="box green" id="B"
    data-anchor-width="A.width / 2"
    data-anchor-height="A.height / 2"
    data-anchor-left="A.left + (B.width * x)"
    data-anchor-vcenter="A.vcenter + (10 * x)">B</div>
  <div class="box" id="C" style="background-color: blue"
    data-anchor-left="B.right"
    data-anchor-top="B.bottom"
    data-anchor-height="B.height * 3"
    data-anchor-width="200">
  </div>
  <div class="box" style="background-color: orange"
    data-anchor-top="C.vcenter"
    data-anchor-right="C.hcenter"
    data-anchor-width="C.height / 2"
    data-anchor-height="100">
  </div>

  <button id="pause">Pause</button>

  <script>

    window.layout = new LayoutManager();

    let elements = document.getElementsByTagName("*");

    for (let i = 0; i < elements.length; i++) {
      let el = elements[i];
      let isRegistered = false;
      let manager = null;
      Object.keys(el.dataset).forEach(function (key) {
        if (key.indexOf("anchor") === 0) {
          if (!isRegistered) {
            let container = null;
            if (el.dataset["anchorIn"]) {
              container = document.getElementById(el.dataset["anchorIn"]);
            }
            manager = layout.register(el, container);
            isRegistered = true;
          }
          let property = key.substr(6).toLowerCase();
          if (property !== "" && property !== "in") {
            manager.constrain(property, el.dataset[key]);
          }
        }
      });
    }


    function makeOscillator() {

      let step = 0.01;
      let current = 0;

      return function () {
        current += step;
        if (current >= 1) {
          current = 1;
          step = step * -1;
        }
        else if (current <= 0) {
          current = 0;
          step = step * -1;
        }
        return current;
      };
    }

    let oscillator = makeOscillator();

    layout.system.assign("x", oscillator());
    layout.updateSystem();
    layout.updateLayout();

    let paused = false;

    setInterval(function () {
      if (paused) {
        return;
      }
      layout.system.assign("x", oscillator());
      layout.updateLayout();
    }, 10);

    document.getElementById("pause").addEventListener("click", function () {
      paused = !paused;
    });

  </script>

</body>
</html>
