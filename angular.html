<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>Playground</title>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script>
  <script src="../build/Variable.js"></script>
  <script src="../build/Parser.js"></script>
  <script src="../build/Relationships.js"></script>
  <script src="../build/System.js"></script>
  <script src="../build/Utils.js"></script>
  <script src="../build/Watcher.js"></script>
  <script src="../build/Axis.js"></script>
  <script src="../build/Rect.js"></script>
  <script src="../build/ManagedRect.js"></script>
  <script src="../build/ElementRect.js"></script>
  <script src="../build/SpecialRects.js"></script>
  <script src="../build/Layout.js"></script>
  <script src="../build/Angular.js"></script>

  <style>

    #A {
      background-color: red;
    }

    #origin {
      background-color: black;
    }

  </style>

  <script type="text/robin">

    #A {
      height: 200px;
      width: 200px * x;
    }

    #origin {
      center-x: viewport.center-x;
      center-y: viewport.center-y;
      width: 100px;
      height: 100px;
    }

  </script>

  <script>

    function makeOscillator() {

      let step = 0.01;
      let current = 0;

      return function () {
        current += step;
        if (current >= 1) {
          current = 1;
          step = step * -1;
        }
        else if (current <= 0) {
          current = 0;
          step = step * -1;
        }
        return current;
      };
    }

    function getRandomColor() {
      let letters = '0123456789ABCDEF'.split('');
      let color = '#';
      for (let i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
      }
      return color;
    }

    angular.module("App", ["robin"]).controller("MainController", function ($scope, layout) {

      window.layout = layout;

      $scope.min = Math.min.bind(Math);
      $scope.max = Math.max.bind(Math);
      $scope.sin = Math.sin.bind(Math);
      $scope.cos = Math.cos.bind(Math);
      $scope.rand = Math.random.bind(Math);

      let oscillator = makeOscillator();
      let counter = 0;

      $scope.x = oscillator();
      $scope.y = counter;

      setInterval(function () {
        counter += 0.01;
        $scope.x = oscillator();
        $scope.y = counter;
        $scope.$digest();
      }, 10);

      $scope.rects = [];
      for (let i = 0; i < 100; i++) {
        let color = getRandomColor();
        $scope.rects.push(color);
      }

    });

  </script>

</head>
<body ng-app="App" ng-controller="MainController">
  <div rect id="origin"></div>
  <div rect
    ng-repeat="r in rects"
    r-center-x="origin.center-x + sin(y * ($index + 1)) * 20px * x * ($index + 1)"
    r-center-y="origin.center-y + cos(y * ($index + 1)) * 20px * x * ($index + 1)"
    r-width="max(20px, 50px * x)"
    r-height="max(20px, 50px * x)"
    ng-style="{ 'background-color': r }">{{$index}}</div>
</body>
</html>
