<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>Playground</title>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script>
  <script src="../build/Variable.js"></script>
  <script src="../build/Parser.js"></script>
  <script src="../build/Relationships.js"></script>
  <script src="../build/System.js"></script>
  <script src="../build/Utils.js"></script>
  <script src="../build/Watcher.js"></script>
  <script src="../build/Axis.js"></script>
  <script src="../build/Rect.js"></script>
  <script src="../build/ManagedRect.js"></script>
  <script src="../build/ElementRect.js"></script>
  <script src="../build/SpecialRects.js"></script>
  <script src="../build/Environment.js"></script>
  <script src="../build/Layout.js"></script>
  <script src="../build/Angular.js"></script>

  <style>

    #A {
      background-color: red;
    }

    #origin {
      background-color: black;
      border-radius: 30px;
    }

    .sub_block {
      background-color: red;
      border-radius: 5px;
    }

  </style>

  <script type="text/absolution">

    #A {
      height: 200px;
      width: 200px * x;
    }

    #origin {
      center-x: viewport.center-x + sin(y * -10) * 100px;
      center-y: viewport.center-y + cos(y * -10) * 100px;
      width:    100px;
      height:   100px;
    }

    .block {
      center-x: origin.center-x + sin(y * ($index + 1)) * 70px * x * ($index + 1);
      center-y: origin.center-y + cos(y * ($index + 1)) * 70px * x * ($index + 1);
    }

    .sub_block {
      width:    10px;
      height:   10px;
      center-x: parent.center-x + sin(y * ($index + 1)) * 70px * x * ($index + 1);
      center-y: parent.center-y + cos(y * ($index + 1)) * 70px * x * ($index + 1);
    }

  </script>

  <script>

    function makeOscillator() {

      let step = 0.01;
      let current = 0;
      let sign = 1;

      return function next() {
        let result = current + step * sign;
        if (result < 0 || 1 < result) {
          sign *= -1;
          return next();
        }
        return current = result;
      };
    }

    function getRandomColor() {
      let letters = '0123456789ABCDEF'.split('');
      let color = '#';
      for (let i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
      }
      return color;
    }

    angular.module("App", ["absolution"]).controller("MainController", function ($scope, layout) {

      window.layout = layout;

      $scope.min = Math.min.bind(Math);
      $scope.max = Math.max.bind(Math);
      $scope.sin = Math.sin.bind(Math);
      $scope.cos = Math.cos.bind(Math);
      $scope.rand = Math.random.bind(Math);

      let oscillator = makeOscillator();
      let counter = 0;

      $scope.x = oscillator();
      $scope.y = counter;

      setInterval(function () {
        counter += 0.01;
        $scope.x = oscillator();
        $scope.y = counter;
        $scope.$digest();
      }, 10);

      $scope.rects = [];
      for (let i = 0; i < 20; i++) {
        let color = getRandomColor();
        $scope.rects.push(color);
      }

    });

  </script>

</head>
<body ng-app="App" ng-controller="MainController">
  <div a-rect id="origin"></div>
  <div a-rect
    ng-repeat="r in rects"
    a-class="block"
    a-style="width: max(20px, 50px * x)"
    a-height="max(20px, 50px * x)"
    ng-style="{ 'background-color': r }">

    <div a-rect 
      ng-repeat="r in rects" 
      a-class="sub_block"
      ng-style="{ 'background-color': r }">
    </div>

  </div>
</body>
</html>
